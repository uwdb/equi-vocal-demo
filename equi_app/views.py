import random
from django.shortcuts import render
from django.http import HttpResponse, JsonResponse
from django.template import loader
from sklearn.metrics import f1_score
from rest_framework.views import APIView
from django.templatetags.static import static
import os, json
import numpy as np
import pickle
import sys
sys.path.append("/Users/zhangenhao/Desktop/UW/Research/equi-vocal-demo/EQUI-VOCAL")
from src.synthesize import test_algorithm_interactive

example_queries = [
    {"vids": [2312, 569, 2669, 9478, 5090, 3220, 7969, 6926, 1233, 7829],
    "labels": [1, 1, 1, 1, 1, 0, 0, 0, 0, 0],
    "query_text": "A purple object is far from a cyan object, then they move near each other.",
    "query_datalog": """
g1(vid, fid, oid1, oid2) :-
    Objects(vid, fid, oid1, _, _, _, _, _),
    Objects(vid, fid, oid2, _, _, _, _, _),
    Relationships(vid, fid, _, oid1, 'Far', oid2),
    Attributes(vid, fid, oid1, 'color', 'purple'),
    Attributes(vid, fid, oid2, 'color', 'cyan'),
    oid1 != oid2.

g1_star(vid, fid, fid, oid1, oid2) :- g1(vid, fid, oid1, oid2).
g1_star(vid, fid_start, fid_end, oid1, oid2) :-
    g1_star(vid, fid_start, fid, oid1, oid2),
    g1(vid, fid_end, oid1, oid2), fid_end = fid + 1.

g2(vid, fid, oid1, oid2) :-
    Objects(vid, fid, oid1, _, _, _, _, _),
    Objects(vid, fid, oid2, _, _, _, _, _),
    Relationships(vid, fid, _, oid1, 'Near', oid2),
    oid1 != oid2.

g2_star(vid, fid, fid, oid1, oid2) :- g2(vid, fid, oid1, oid2).
g2_star(vid, fid_start, fid_end, oid1, oid2) :-
    g2_star(vid, fid_start, fid, oid1, oid2),
    g2(vid, fid_end, oid1, oid2), fid_end = fid + 1.

q(vid) :- g1_star(vid, fid11, fid12, oid1, oid2),
    g2_star(vid, fid21, fid22, oid1, oid2), fid21 > fid12.
        """,
    "query_str": 'Conjunction(Conjunction(Color_purple(o0), Color_cyan(o1)), Far_3.0(o0, o1)); Near_1.0(o0, o1)',
    "log": [{'iteration': 0, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 7, 'best_query': 'Color_purple(o0)', 'best_score': 0.7682307692307693, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_01000-02000/video_01720.mp4', '/static/equi_app/clevrer/video_01000-02000/video_01756.mp4'], 'predicted_labels_test': [1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1]}, {'iteration': 1, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 9, 'best_query': 'Conjunction(Color_cyan(o0), Color_purple(o1))', 'best_score': 0.9070909090909091, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_06000-07000/video_06283.mp4', '/static/equi_app/clevrer/video_01000-02000/video_01239.mp4'], 'predicted_labels_test': [1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1]}, {'iteration': 2, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 11, 'best_query': 'RightOf(o0, o1); Conjunction(Color_purple(o2), Color_cyan(o1))', 'best_score': 0.9060909090909091, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_09000-10000/video_09343.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07523.mp4'], 'predicted_labels_test': [1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1]}, {'iteration': 3, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 13, 'best_query': 'Far_3.0(o0, o1); Conjunction(Color_purple(o1), Near_1.0(o0, o1)); Color_cyan(o0)', 'best_score': 0.996, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_00000-01000/video_00351.mp4', '/static/equi_app/clevrer/video_03000-04000/video_03716.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 4, 'selected_gt_labels': [1, 1, 1], 'current_npos': 8, 'current_nneg': 13, 'best_query': 'Far_3.0(o0, o1); Conjunction(Color_purple(o0), Near_1.0(o0, o1)); Color_cyan(o1)', 'best_score': 0.996, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_09000-10000/video_09459.mp4', '/static/equi_app/clevrer/video_05000-06000/video_05379.mp4', '/static/equi_app/clevrer/video_01000-02000/video_01854.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 5, 'selected_gt_labels': [1, 1, 1], 'current_npos': 11, 'current_nneg': 13, 'best_query': 'Far_3.0(o0, o1); Near_1.0(o0, o1); Conjunction(Color_cyan(o0), Color_purple(o1))', 'best_score': 0.996, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_06000-07000/video_06874.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06271.mp4', '/static/equi_app/clevrer/video_00000-01000/video_00432.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 6, 'selected_gt_labels': [1, 1, 1], 'current_npos': 14, 'current_nneg': 13, 'best_query': 'Far_3.0(o0, o1); Near_1.0(o0, o1); Conjunction(Color_cyan(o0), Color_purple(o1))', 'best_score': 0.996, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_08000-09000/video_08467.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07731.mp4', '/static/equi_app/clevrer/video_00000-01000/video_00026.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 7, 'selected_gt_labels': [1, 0, 1], 'current_npos': 16, 'current_nneg': 14, 'best_query': 'Far_3.0(o0, o1); Conjunction(Color_purple(o1), Near_1.0(o0, o1)); Color_cyan(o0)', 'best_score': 0.996, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_02000-03000/video_02905.mp4', '/static/equi_app/clevrer/video_00000-01000/video_00050.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07039.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 8, 'selected_gt_labels': [1, 1, 1], 'current_npos': 19, 'current_nneg': 14, 'best_query': 'Far_3.0(o0, o1); Conjunction(Color_cyan(o0), Color_purple(o1)); Near_1.0(o0, o1)', 'best_score': 0.996, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_02000-03000/video_02035.mp4', '/static/equi_app/clevrer/video_05000-06000/video_05724.mp4', '/static/equi_app/clevrer/video_04000-05000/video_04028.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 9, 'selected_gt_labels': [1, 0, 1], 'current_npos': 21, 'current_nneg': 15, 'best_query': 'Far_3.0(o0, o1); Conjunction(Color_purple(o1), Near_1.0(o0, o1)); Color_cyan(o0)', 'best_score': 0.996, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_08000-09000/video_08368.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07018.mp4', '/static/equi_app/clevrer/video_00000-01000/video_00524.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 10, 'selected_gt_labels': [1, 1, 1], 'current_npos': 24, 'current_nneg': 15, 'best_query': 'Far_3.0(o0, o1); Conjunction(Color_purple(o0), Near_1.0(o0, o1)); Color_cyan(o1)', 'best_score': 0.996, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_06000-07000/video_06903.mp4', '/static/equi_app/clevrer/video_05000-06000/video_05508.mp4', '/static/equi_app/clevrer/video_01000-02000/video_01486.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 11, 'selected_gt_labels': [0, 1, 0], 'current_npos': 25, 'current_nneg': 17, 'best_query': 'Far_3.0(o0, o1); Near_1.0(o0, o1); Conjunction(Color_cyan(o0), Color_purple(o1))', 'best_score': 0.996, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_04000-05000/video_04594.mp4', '/static/equi_app/clevrer/video_00000-01000/video_00296.mp4', '/static/equi_app/clevrer/video_00000-01000/video_00336.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 12, 'selected_gt_labels': [0, 0], 'current_npos': 25, 'current_nneg': 19, 'best_query': 'Far_3.0(o0, o1); Conjunction(Conjunction(Color_cyan(o0), Color_purple(o1)), Near_1.0(o0, o1))', 'best_score': 0.996, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_01000-02000/video_01574.mp4', '/static/equi_app/clevrer/video_02000-03000/video_02549.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 13, 'selected_gt_labels': [0, 0], 'current_npos': 25, 'current_nneg': 21, 'best_query': 'Far_3.0(o0, o1); Conjunction(Conjunction(Color_cyan(o0), Color_purple(o1)), Near_1.0(o0, o1))', 'best_score': 0.996, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_00000-01000/video_00080.mp4', '/static/equi_app/clevrer/video_05000-06000/video_05184.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 14, 'selected_gt_labels': [0, 0], 'current_npos': 25, 'current_nneg': 23, 'best_query': 'Far_3.0(o0, o1); Conjunction(Color_purple(o1), Near_1.0(o0, o1)); Color_cyan(o0)', 'best_score': 0.996, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_01000-02000/video_01764.mp4', '/static/equi_app/clevrer/video_00000-01000/video_00578.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 15, 'selected_gt_labels': [0, 0], 'current_npos': 25, 'current_nneg': 25, 'best_query': 'Far_3.0(o0, o1); Conjunction(Color_purple(o0), Near_1.0(o0, o1)); Color_cyan(o1)', 'best_score': 0.996, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_06000-07000/video_06762.mp4', '/static/equi_app/clevrer/video_00000-01000/video_00391.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}]
    },
    {"vids": [1249, 5111, 1463, 6294, 2437, 2730, 3977, 661, 2287, 9521],
    "labels": [1, 1, 1, 1, 1, 0, 0, 0, 0, 0],
    "query_text": "A red object is located to the left of a cube while a third object is located at the top, then the cube moves to the bottom.",
    "query_datalog": """
        """,
    "query_str": 'Conjunction(Conjunction(Conjunction(Color_red(o0), LeftOf(o0, o1)), Shape_cube(o1)), TopQuadrant(o2)); BottomQuadrant(o2)',
    "log": [{'iteration': 0, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 7, 'best_query': 'Color_red(o0)', 'best_score': 0.8323333333333333, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_07000-08000/video_07291.mp4', '/static/equi_app/clevrer/video_04000-05000/video_04012.mp4'], 'predicted_labels_test': [1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1]}, {'iteration': 1, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 9, 'best_query': 'BottomQuadrant(o0); Color_red(o1)', 'best_score': 0.8313333333333333, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_07000-08000/video_07427.mp4', '/static/equi_app/clevrer/video_00000-01000/video_00100.mp4'], 'predicted_labels_test': [1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1]}, {'iteration': 2, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 11, 'best_query': 'Color_red(o0); Conjunction(BottomQuadrant(o1), LeftOf(o0, o1))', 'best_score': 0.997, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_03000-04000/video_03733.mp4', '/static/equi_app/clevrer/video_08000-09000/video_08264.mp4'], 'predicted_labels_test': [0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0]}, {'iteration': 3, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 13, 'best_query': 'TopQuadrant(o0); Color_red(o1); BottomQuadrant(o0)', 'best_score': 0.997, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_05000-06000/video_05804.mp4', '/static/equi_app/clevrer/video_04000-05000/video_04711.mp4'], 'predicted_labels_test': [0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1]}, {'iteration': 4, 'selected_gt_labels': [0, 0, 0], 'current_npos': 5, 'current_nneg': 16, 'best_query': 'Conjunction(Conjunction(Color_red(o0), LeftOf(o0, o1)), TopQuadrant(o2)); Conjunction(BottomQuadrant(o2), FrontOf(o0, o1))', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_07000-08000/video_07260.mp4', '/static/equi_app/clevrer/video_01000-02000/video_01232.mp4', '/static/equi_app/clevrer/video_00000-01000/video_00542.mp4'], 'predicted_labels_test': [0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0]}, {'iteration': 5, 'selected_gt_labels': [1, 0, 1], 'current_npos': 7, 'current_nneg': 17, 'best_query': 'Conjunction(Conjunction(LeftOf(o0, o1), Shape_cube(o1)), TopQuadrant(o2)); Conjunction(BottomQuadrant(o2), Color_red(o0))', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_04000-05000/video_04075.mp4', '/static/equi_app/clevrer/video_01000-02000/video_01578.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06678.mp4'], 'predicted_labels_test': [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0]}, {'iteration': 6, 'selected_gt_labels': [1, 1, 1], 'current_npos': 10, 'current_nneg': 17, 'best_query': 'Conjunction(Conjunction(Color_red(o0), LeftOf(o0, o1)), TopQuadrant(o2)); Conjunction(BottomQuadrant(o2), Shape_cube(o1))', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_06000-07000/video_06330.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07405.mp4', '/static/equi_app/clevrer/video_09000-10000/video_09549.mp4'], 'predicted_labels_test': [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0]}, {'iteration': 7, 'selected_gt_labels': [1, 1, 1], 'current_npos': 13, 'current_nneg': 17, 'best_query': 'Conjunction(LeftOf(o0, o1), TopQuadrant(o2)); Conjunction(BottomQuadrant(o2), Color_red(o0)); Shape_cube(o1)', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_01000-02000/video_01055.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06694.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06115.mp4'], 'predicted_labels_test': [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0]}, {'iteration': 8, 'selected_gt_labels': [1, 1, 1], 'current_npos': 16, 'current_nneg': 17, 'best_query': 'Conjunction(Conjunction(Conjunction(Color_red(o0), LeftOf(o0, o1)), Shape_cube(o1)), TopQuadrant(o2)); BottomQuadrant(o2)', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_00000-01000/video_00084.mp4', '/static/equi_app/clevrer/video_03000-04000/video_03095.mp4', '/static/equi_app/clevrer/video_04000-05000/video_04907.mp4'], 'predicted_labels_test': [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0]}, {'iteration': 9, 'selected_gt_labels': [1, 0, 0], 'current_npos': 17, 'current_nneg': 19, 'best_query': 'Conjunction(Conjunction(Conjunction(Color_red(o0), LeftOf(o0, o1)), Shape_cube(o1)), TopQuadrant(o2)); BottomQuadrant(o2)', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_09000-10000/video_09853.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06117.mp4', '/static/equi_app/clevrer/video_03000-04000/video_03067.mp4'], 'predicted_labels_test': [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0]}, {'iteration': 10, 'selected_gt_labels': [1, 1, 0], 'current_npos': 19, 'current_nneg': 20, 'best_query': 'Conjunction(LeftOf(o0, o1), TopQuadrant(o2)); Shape_cube(o1); Conjunction(BottomQuadrant(o2), Color_red(o0))', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_05000-06000/video_05489.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06184.mp4', '/static/equi_app/clevrer/video_08000-09000/video_08897.mp4'], 'predicted_labels_test': [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0]}, {'iteration': 11, 'selected_gt_labels': [1, 1, 1], 'current_npos': 22, 'current_nneg': 20, 'best_query': 'Conjunction(Conjunction(Conjunction(Color_red(o0), LeftOf(o0, o1)), Shape_cube(o1)), TopQuadrant(o2)); BottomQuadrant(o2)', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_08000-09000/video_08750.mp4', '/static/equi_app/clevrer/video_00000-01000/video_00473.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07325.mp4'], 'predicted_labels_test': [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0]}, {'iteration': 12, 'selected_gt_labels': [0, 1], 'current_npos': 23, 'current_nneg': 21, 'best_query': 'Conjunction(LeftOf(o0, o1), TopQuadrant(o2)); Shape_cube(o1); Conjunction(BottomQuadrant(o2), Color_red(o0))', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_07000-08000/video_07863.mp4', '/static/equi_app/clevrer/video_04000-05000/video_04011.mp4'], 'predicted_labels_test': [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0]}, {'iteration': 13, 'selected_gt_labels': [0, 0], 'current_npos': 23, 'current_nneg': 23, 'best_query': 'Conjunction(Conjunction(Conjunction(Color_red(o0), LeftOf(o0, o1)), Shape_cube(o1)), TopQuadrant(o2)); BottomQuadrant(o2)', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_05000-06000/video_05222.mp4', '/static/equi_app/clevrer/video_02000-03000/video_02821.mp4'], 'predicted_labels_test': [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0]}, {'iteration': 14, 'selected_gt_labels': [1, 1], 'current_npos': 25, 'current_nneg': 23, 'best_query': 'Shape_cube(o0); Conjunction(Conjunction(Color_red(o1), RightOf(o0, o1)), TopQuadrant(o2)); BottomQuadrant(o2)', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_01000-02000/video_01904.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07574.mp4'], 'predicted_labels_test': [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0]}, {'iteration': 15, 'selected_gt_labels': [0, 0], 'current_npos': 25, 'current_nneg': 25, 'best_query': 'Conjunction(Conjunction(LeftOf(o0, o1), Shape_cube(o1)), TopQuadrant(o2)); Conjunction(BottomQuadrant(o2), Color_red(o0))', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_03000-04000/video_03345.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06615.mp4'], 'predicted_labels_test': [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0]}]
    },
    {"vids": [9657, 4181, 8921, 4246, 7608, 5907, 340, 7056, 1990, 243],
    "labels": [1, 1, 1, 1, 1, 0, 0, 0, 0, 0],
    "query_text": "A yellow object is located to the left of a cylinder for at least 10 frames, then the yellow object comes to the right of the same cylinder for at least 10 frames.",
    "query_datalog": """
        """,
    "query_str": 'Duration(Conjunction(Conjunction(Color_yellow(o0), LeftOf(o0, o1)), Shape_cylinder(o1)), 10); Duration(RightOf(o0, o1), 10)',
    "log": [{'iteration': 0, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 7, 'best_query': 'Color_yellow(o0)', 'best_score': 0.999, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_00000-01000/video_00271.mp4', '/static/equi_app/clevrer/video_01000-02000/video_01312.mp4'], 'predicted_labels_test': [1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1]}, {'iteration': 1, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 9, 'best_query': 'LeftOf(o0, o1); Color_yellow(o1)', 'best_score': 0.998, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_03000-04000/video_03380.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07133.mp4'], 'predicted_labels_test': [1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1]}, {'iteration': 2, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 11, 'best_query': 'RightOf(o0, o1); Shape_cylinder(o1); Color_yellow(o0)', 'best_score': 0.997, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_00000-01000/video_00822.mp4', '/static/equi_app/clevrer/video_04000-05000/video_04481.mp4'], 'predicted_labels_test': [1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0]}, {'iteration': 3, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 13, 'best_query': 'Color_yellow(o0); Shape_cylinder(o1); RightQuadrant(o0)', 'best_score': 0.997, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_04000-05000/video_04798.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06638.mp4'], 'predicted_labels_test': [1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0]}, {'iteration': 4, 'selected_gt_labels': [0, 1, 0], 'current_npos': 6, 'current_nneg': 15, 'best_query': 'Conjunction(Conjunction(Behind(o0, o1), Color_yellow(o0)), Shape_cylinder(o2)); RightQuadrant(o0); LeftOf(o0, o2)', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_00000-01000/video_00095.mp4', '/static/equi_app/clevrer/video_03000-04000/video_03249.mp4', '/static/equi_app/clevrer/video_02000-03000/video_02273.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 5, 'selected_gt_labels': [1, 0, 0], 'current_npos': 7, 'current_nneg': 17, 'best_query': 'RightOf(o0, o1); Conjunction(Conjunction(Color_yellow(o1), LeftOf(o1, o2)), Shape_cylinder(o2)); RightQuadrant(o1)', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_09000-10000/video_09701.mp4', '/static/equi_app/clevrer/video_02000-03000/video_02842.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06443.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 6, 'selected_gt_labels': [0, 0, 0], 'current_npos': 7, 'current_nneg': 20, 'best_query': 'RightOf(o0, o1); Conjunction(Color_yellow(o1), Shape_cylinder(o2)); Conjunction(LeftOf(o1, o2), RightQuadrant(o1))', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_06000-07000/video_06216.mp4', '/static/equi_app/clevrer/video_03000-04000/video_03097.mp4', '/static/equi_app/clevrer/video_09000-10000/video_09664.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 7, 'selected_gt_labels': [0, 1, 0], 'current_npos': 8, 'current_nneg': 22, 'best_query': 'Conjunction(Conjunction(FrontOf(o0, o1), LeftOf(o0, o1)), LeftOf(o1, o2)); Conjunction(Color_yellow(o1), Shape_cylinder(o2)); Conjunction(Color_yellow(o1), Far_3.0(o0, o1))', 'best_score': 0.993, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_06000-07000/video_06066.mp4', '/static/equi_app/clevrer/video_04000-05000/video_04661.mp4', '/static/equi_app/clevrer/video_01000-02000/video_01764.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0]}, {'iteration': 8, 'selected_gt_labels': [1, 0, 0], 'current_npos': 9, 'current_nneg': 24, 'best_query': 'Conjunction(Conjunction(Conjunction(Far_3.0(o0, o1), FrontOf(o0, o1)), LeftOf(o0, o1)), LeftOf(o1, o2)); Conjunction(Color_yellow(o1), Shape_cylinder(o2)); Color_yellow(o1)', 'best_score': 0.9403684210526316, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_09000-10000/video_09043.mp4', '/static/equi_app/clevrer/video_08000-09000/video_08152.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07406.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0]}, {'iteration': 9, 'selected_gt_labels': [1, 1, 0], 'current_npos': 11, 'current_nneg': 25, 'best_query': 'Conjunction(Conjunction(FrontOf(o0, o1), LeftOf(o0, o1)), LeftOf(o1, o2)); Conjunction(Color_yellow(o1), Shape_cylinder(o2)); Duration(Conjunction(Color_yellow(o1), LeftQuadrant(o0)), 5)', 'best_score': 0.9084666666666666, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_09000-10000/video_09649.mp4', '/static/equi_app/clevrer/video_01000-02000/video_01330.mp4', '/static/equi_app/clevrer/video_08000-09000/video_08304.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0]}, {'iteration': 10, 'selected_gt_labels': [0, 0, 1], 'current_npos': 12, 'current_nneg': 27, 'best_query': 'Conjunction(Conjunction(Conjunction(Far_3.0(o0, o1), FrontOf(o0, o1)), LeftOf(o0, o1)), LeftOf(o1, o2)); Conjunction(Color_yellow(o1), Shape_cylinder(o2)); Color_yellow(o1)', 'best_score': 0.9096666666666666, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_06000-07000/video_06793.mp4', '/static/equi_app/clevrer/video_01000-02000/video_01538.mp4', '/static/equi_app/clevrer/video_03000-04000/video_03262.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0]}, {'iteration': 11, 'selected_gt_labels': [0, 0, 0], 'current_npos': 12, 'current_nneg': 30, 'best_query': 'Conjunction(Conjunction(Conjunction(Far_3.0(o0, o1), FrontOf(o0, o1)), LeftOf(o0, o1)), LeftOf(o1, o2)); Conjunction(Color_yellow(o1), Shape_cylinder(o2)); Color_yellow(o1)', 'best_score': 0.8729999999999999, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_03000-04000/video_03545.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07326.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07491.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0]}, {'iteration': 12, 'selected_gt_labels': [0, 1], 'current_npos': 13, 'current_nneg': 31, 'best_query': 'Conjunction(Conjunction(Conjunction(Far_3.0(o0, o1), FrontOf(o0, o1)), LeftOf(o0, o1)), LeftOf(o1, o2)); Conjunction(Color_yellow(o1), Shape_cylinder(o2)); Color_yellow(o1)', 'best_score': 0.8078148148148148, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_05000-06000/video_05534.mp4', '/static/equi_app/clevrer/video_09000-10000/video_09752.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0]}, {'iteration': 13, 'selected_gt_labels': [1, 1], 'current_npos': 15, 'current_nneg': 31, 'best_query': 'Conjunction(Conjunction(FrontOf(o0, o1), LeftOf(o0, o1)), LeftOf(o1, o2)); Conjunction(Conjunction(Color_yellow(o1), Far_3.0(o0, o1)), Shape_cylinder(o2)); Color_yellow(o1)', 'best_score': 0.8055, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_04000-05000/video_04921.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06313.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0]}, {'iteration': 14, 'selected_gt_labels': [0, 0], 'current_npos': 15, 'current_nneg': 33, 'best_query': 'Duration(Conjunction(LeftOf(o0, o1), Shape_cylinder(o2)), 5); Conjunction(Conjunction(BottomQuadrant(o0), Far_3.0(o0, o2)), RightQuadrant(o1)); Conjunction(Color_yellow(o1), LeftQuadrant(o0))', 'best_score': 0.7610307692307692, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_08000-09000/video_08065.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06031.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]}, {'iteration': 15, 'selected_gt_labels': [1, 0], 'current_npos': 16, 'current_nneg': 34, 'best_query': 'Conjunction(Conjunction(FrontOf(o0, o1), LeftOf(o0, o1)), LeftOf(o1, o2)); Duration(Conjunction(Color_yellow(o1), Shape_cylinder(o2)), 5); Conjunction(Color_yellow(o1), LeftQuadrant(o0))', 'best_score': 0.7359860465116279, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_09000-10000/video_09389.mp4', '/static/equi_app/clevrer/video_05000-06000/video_05782.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0]}],
    },
    # Live Query (Placeholder)
    {"vids": [9657, 4181, 8921, 4246, 7608, 5907, 340, 7056, 1990, 243],
    "labels": [1, 1, 1, 1, 1, 0, 0, 0, 0, 0],
    "query_text": "A yellow object is located to the left of a cylinder for at least 10 frames, then the yellow object comes to the right of the same cylinder for at least 10 frames.",
    "query_datalog": """
        """,
    "query_str": 'Duration(Conjunction(Conjunction(Color_yellow(o0), LeftOf(o0, o1)), Shape_cylinder(o1)), 10); Duration(RightOf(o0, o1), 10)',
    "log": [{'iteration': 0, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 7, 'best_query': 'Color_yellow(o0)', 'best_score': 0.999, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_00000-01000/video_00271.mp4', '/static/equi_app/clevrer/video_01000-02000/video_01312.mp4'], 'predicted_labels_test': [1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1]}, {'iteration': 1, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 9, 'best_query': 'LeftOf(o0, o1); Color_yellow(o1)', 'best_score': 0.998, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_03000-04000/video_03380.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07133.mp4'], 'predicted_labels_test': [1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1]}, {'iteration': 2, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 11, 'best_query': 'RightOf(o0, o1); Shape_cylinder(o1); Color_yellow(o0)', 'best_score': 0.997, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_00000-01000/video_00822.mp4', '/static/equi_app/clevrer/video_04000-05000/video_04481.mp4'], 'predicted_labels_test': [1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0]}, {'iteration': 3, 'selected_gt_labels': [0, 0], 'current_npos': 5, 'current_nneg': 13, 'best_query': 'Color_yellow(o0); Shape_cylinder(o1); RightQuadrant(o0)', 'best_score': 0.997, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_04000-05000/video_04798.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06638.mp4'], 'predicted_labels_test': [1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0]}, {'iteration': 4, 'selected_gt_labels': [0, 1, 0], 'current_npos': 6, 'current_nneg': 15, 'best_query': 'Conjunction(Conjunction(Behind(o0, o1), Color_yellow(o0)), Shape_cylinder(o2)); RightQuadrant(o0); LeftOf(o0, o2)', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_00000-01000/video_00095.mp4', '/static/equi_app/clevrer/video_03000-04000/video_03249.mp4', '/static/equi_app/clevrer/video_02000-03000/video_02273.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 5, 'selected_gt_labels': [1, 0, 0], 'current_npos': 7, 'current_nneg': 17, 'best_query': 'RightOf(o0, o1); Conjunction(Conjunction(Color_yellow(o1), LeftOf(o1, o2)), Shape_cylinder(o2)); RightQuadrant(o1)', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_09000-10000/video_09701.mp4', '/static/equi_app/clevrer/video_02000-03000/video_02842.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06443.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 6, 'selected_gt_labels': [0, 0, 0], 'current_npos': 7, 'current_nneg': 20, 'best_query': 'RightOf(o0, o1); Conjunction(Color_yellow(o1), Shape_cylinder(o2)); Conjunction(LeftOf(o1, o2), RightQuadrant(o1))', 'best_score': 0.995, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_06000-07000/video_06216.mp4', '/static/equi_app/clevrer/video_03000-04000/video_03097.mp4', '/static/equi_app/clevrer/video_09000-10000/video_09664.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]}, {'iteration': 7, 'selected_gt_labels': [0, 1, 0], 'current_npos': 8, 'current_nneg': 22, 'best_query': 'Conjunction(Conjunction(FrontOf(o0, o1), LeftOf(o0, o1)), LeftOf(o1, o2)); Conjunction(Color_yellow(o1), Shape_cylinder(o2)); Conjunction(Color_yellow(o1), Far_3.0(o0, o1))', 'best_score': 0.993, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_06000-07000/video_06066.mp4', '/static/equi_app/clevrer/video_04000-05000/video_04661.mp4', '/static/equi_app/clevrer/video_01000-02000/video_01764.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0]}, {'iteration': 8, 'selected_gt_labels': [1, 0, 0], 'current_npos': 9, 'current_nneg': 24, 'best_query': 'Conjunction(Conjunction(Conjunction(Far_3.0(o0, o1), FrontOf(o0, o1)), LeftOf(o0, o1)), LeftOf(o1, o2)); Conjunction(Color_yellow(o1), Shape_cylinder(o2)); Color_yellow(o1)', 'best_score': 0.9403684210526316, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_09000-10000/video_09043.mp4', '/static/equi_app/clevrer/video_08000-09000/video_08152.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07406.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0]}, {'iteration': 9, 'selected_gt_labels': [1, 1, 0], 'current_npos': 11, 'current_nneg': 25, 'best_query': 'Conjunction(Conjunction(FrontOf(o0, o1), LeftOf(o0, o1)), LeftOf(o1, o2)); Conjunction(Color_yellow(o1), Shape_cylinder(o2)); Duration(Conjunction(Color_yellow(o1), LeftQuadrant(o0)), 5)', 'best_score': 0.9084666666666666, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_09000-10000/video_09649.mp4', '/static/equi_app/clevrer/video_01000-02000/video_01330.mp4', '/static/equi_app/clevrer/video_08000-09000/video_08304.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0]}, {'iteration': 10, 'selected_gt_labels': [0, 0, 1], 'current_npos': 12, 'current_nneg': 27, 'best_query': 'Conjunction(Conjunction(Conjunction(Far_3.0(o0, o1), FrontOf(o0, o1)), LeftOf(o0, o1)), LeftOf(o1, o2)); Conjunction(Color_yellow(o1), Shape_cylinder(o2)); Color_yellow(o1)', 'best_score': 0.9096666666666666, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_06000-07000/video_06793.mp4', '/static/equi_app/clevrer/video_01000-02000/video_01538.mp4', '/static/equi_app/clevrer/video_03000-04000/video_03262.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0]}, {'iteration': 11, 'selected_gt_labels': [0, 0, 0], 'current_npos': 12, 'current_nneg': 30, 'best_query': 'Conjunction(Conjunction(Conjunction(Far_3.0(o0, o1), FrontOf(o0, o1)), LeftOf(o0, o1)), LeftOf(o1, o2)); Conjunction(Color_yellow(o1), Shape_cylinder(o2)); Color_yellow(o1)', 'best_score': 0.8729999999999999, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_03000-04000/video_03545.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07326.mp4', '/static/equi_app/clevrer/video_07000-08000/video_07491.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0]}, {'iteration': 12, 'selected_gt_labels': [0, 1], 'current_npos': 13, 'current_nneg': 31, 'best_query': 'Conjunction(Conjunction(Conjunction(Far_3.0(o0, o1), FrontOf(o0, o1)), LeftOf(o0, o1)), LeftOf(o1, o2)); Conjunction(Color_yellow(o1), Shape_cylinder(o2)); Color_yellow(o1)', 'best_score': 0.8078148148148148, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_05000-06000/video_05534.mp4', '/static/equi_app/clevrer/video_09000-10000/video_09752.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0]}, {'iteration': 13, 'selected_gt_labels': [1, 1], 'current_npos': 15, 'current_nneg': 31, 'best_query': 'Conjunction(Conjunction(FrontOf(o0, o1), LeftOf(o0, o1)), LeftOf(o1, o2)); Conjunction(Conjunction(Color_yellow(o1), Far_3.0(o0, o1)), Shape_cylinder(o2)); Color_yellow(o1)', 'best_score': 0.8055, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_04000-05000/video_04921.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06313.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0]}, {'iteration': 14, 'selected_gt_labels': [0, 0], 'current_npos': 15, 'current_nneg': 33, 'best_query': 'Duration(Conjunction(LeftOf(o0, o1), Shape_cylinder(o2)), 5); Conjunction(Conjunction(BottomQuadrant(o0), Far_3.0(o0, o2)), RightQuadrant(o1)); Conjunction(Color_yellow(o1), LeftQuadrant(o0))', 'best_score': 0.7610307692307692, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_08000-09000/video_08065.mp4', '/static/equi_app/clevrer/video_06000-07000/video_06031.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]}, {'iteration': 15, 'selected_gt_labels': [1, 0], 'current_npos': 16, 'current_nneg': 34, 'best_query': 'Conjunction(Conjunction(FrontOf(o0, o1), LeftOf(o0, o1)), LeftOf(o1, o2)); Duration(Conjunction(Color_yellow(o1), Shape_cylinder(o2)), 5); Conjunction(Color_yellow(o1), LeftQuadrant(o0))', 'best_score': 0.7359860465116279, 'terminated': False, 'video_paths': ['/static/equi_app/clevrer/video_09000-10000/video_09389.mp4', '/static/equi_app/clevrer/video_05000-06000/video_05782.mp4'], 'predicted_labels_test': [0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0]}]
    }]

class index(APIView):
    def get(self, request, query_idx=1, format=None):
        request.session.clear()
        request.session['query_idx'] = query_idx
        example_query = example_queries[query_idx]
        vids = example_query["vids"]
        labels = example_query["labels"]
        query_text = example_query["query_text"]
        query_datalog = example_query["query_datalog"]
        context = {
            'video_paths': [('equi_app/clevrer/video_{}-{}/video_{}.mp4'.format(str(vid//1000*1000).zfill(5), str((vid//1000+1)*1000).zfill(5), str(vid).zfill(5)), label) for vid, label in zip(vids, labels)],
            'query_text': query_text,
            'query_datalog': query_datalog,
            'show_parameters': query_idx == 3,
        }
        request.session.modified = True
        print("query_idx:", request.session['query_idx'])
        return render(request, 'equi_app/index.html', context)

class show_more_segments(APIView):
    def get(self, request, format=None):
        vids = random.sample(range(10000), 10)
        # TODO: get labels from database
        labels = [1, 1, 1, 1, 1, 0, 0, 0, 0, 0]
        video_paths = [static('equi_app/clevrer/video_{}-{}/video_{}.mp4'.format(str(vid//1000*1000).zfill(5), str((vid//1000+1)*1000).zfill(5), str(vid).zfill(5))) for vid in vids]
        return JsonResponse({'video_paths': video_paths, 'labels': labels})

class iterative_synthesis_init(APIView):
    def get(self, request, format=None):
        # request.session['query_idx'] = 1
        print("query_idx:", request.session["query_idx"])
        query_idx = request.session['query_idx']
        example_query = example_queries[query_idx]

        predicate_dict = [{"name": "Near", "parameters": [1], "nargs": 2}, {"name": "Far", "parameters": [3], "nargs": 2}, {"name": "LeftOf", "parameters": None, "nargs": 2}, {"name": "Behind", "parameters": None, "nargs": 2}, {"name": "RightOf", "parameters": None, "nargs": 2}, {"name": "FrontOf", "parameters": None, "nargs": 2}, {"name": "RightQuadrant", "parameters": None, "nargs": 1}, {"name": "LeftQuadrant", "parameters": None, "nargs": 1}, {"name": "TopQuadrant", "parameters": None, "nargs": 1}, {"name": "BottomQuadrant", "parameters": None, "nargs": 1}, {"name": "Color", "parameters": ["gray", "red", "blue", "green", "brown", "cyan", "purple", "yellow"], "nargs": 1}, {"name": "Shape", "parameters": ["cube", "sphere", "cylinder"], "nargs": 1}, {"name": "Material", "parameters": ["metal", "rubber"], "nargs": 1}]

        input_dir = "/Users/zhangenhao/Desktop/UW/Research/equi-vocal-demo/EQUI-VOCAL/inputs"
        dataset_name = "demo_queries_scene_graph"
        query_str = example_query["query_str"]
        # query_str = 'Conjunction(Conjunction(Color_red(o0), Color_yellow(o1)), LeftOf(o0, o1)); RightOf(o0, o1)'

        with open(os.path.join(input_dir, dataset_name, "train/{}_inputs.json".format(query_str)), 'r') as f:
            inputs = json.load(f)
        with open(os.path.join(input_dir, dataset_name, "train/{}_labels.json".format(query_str)), 'r') as f:
            labels = json.load(f)
        inputs = np.asarray(inputs)
        labels = np.asarray(labels)

        # Test dataset for interactive demo
        with open(os.path.join(input_dir, dataset_name, "test/{}_inputs.json".format(query_str)), 'r') as f:
            test_inputs = json.load(f)
        with open(os.path.join(input_dir, dataset_name, "test/{}_labels.json".format(query_str)), 'r') as f:
            test_labels = json.load(f)

        test_inputs = np.asarray(test_inputs)[:100]
        test_labels = np.asarray(test_labels)[:100]
        test_video_paths = [static('equi_app/clevrer/video_{}-{}/video_{}.mp4'.format(str(vid//1000*1000).zfill(5), str((vid//1000+1)*1000).zfill(5), str(vid).zfill(5))) for vid in test_inputs]
        request.session["test_video_paths"] = test_video_paths
        request.session["test_labels"] = test_labels.tolist()
        print("test_labels", test_labels)
        # algorithm = test_algorithm_interactive(method="vocal_postgres", dataset_name=dataset_name, n_init_pos=5, n_init_neg=5, npred=7, depth=3, max_duration=15, beam_width=10, pool_size=100, k=100, budget=50, multithread=4, query_str=query_str, predicate_dict=predicate_dict, lru_capacity=None, reg_lambda=0.001, strategy='topk', max_vars=3, port=5432, input_dir=input_dir)

        # init_labeled_index = algorithm.labeled_index.copy()
        # init_vids = inputs[init_labeled_index]
        # log = []
        # while True:
        #     log_dict = algorithm.interactive_main()
        #     if log_dict["terminated"]:
        #         print("Terminated")
        #         break
        #     else:
        #         response = {}
        #         response["iteration"] = log_dict["iteration"]
        #         selected_segments = log_dict["selected_segments"]
        #         response["selected_gt_labels"] = log_dict["selected_gt_labels"]
        #         response["current_npos"] = log_dict["current_npos"]
        #         response["current_nneg"] = log_dict["current_nneg"]
        #         response["best_query"] = log_dict["best_query"]
        #         response["best_score"] = log_dict["best_score"]
        #         response["terminated"] = log_dict["terminated"]
        #         response["video_paths"] = [static('equi_app/clevrer/video_{}-{}/video_{}.mp4'.format(str(inputs[idx]//1000*1000).zfill(5), str((inputs[idx]//1000+1)*1000).zfill(5), str(inputs[idx]).zfill(5))) for idx in selected_segments]
        #         response["predicted_labels_test"] = log_dict["predicted_labels_test"]
        #         log.append(response)
        # print("init vids", init_vids)
        # print("log", log)


        log = example_query["log"]

        request.session["iteration"] = 0
        request.session["log"] = log
        return JsonResponse(post_processing(log[0], test_video_paths, test_labels.tolist()))

class iterative_synthesis(APIView):
    def get(self, request, format=None):
        request.session["iteration"] += 1
        log = request.session["log"]
        if request.session["iteration"] < len(log):
            return JsonResponse(post_processing(log[request.session["iteration"]], request.session["test_video_paths"], request.session["test_labels"]))
        else:
            request.session = {}
            return JsonResponse({"terminated": True})

def post_processing(log, test_video_paths, test_labels):
    log_copy = dict(log)
    predicted_labels_test = log_copy["predicted_labels_test"]
    predicted_pos_video_paths = []
    predicted_pos_video_gt_labels = []
    predicted_neg_video_paths = []
    predicted_neg_video_gt_labels = []
    for (path, gt_l, p_l) in zip(test_video_paths, test_labels, predicted_labels_test):
        if p_l == 1:
            predicted_pos_video_paths.append(path)
            predicted_pos_video_gt_labels.append(gt_l)
        else:
            predicted_neg_video_paths.append(path)
            predicted_neg_video_gt_labels.append(gt_l)
    del log_copy["predicted_labels_test"]
    log_copy["predicted_pos_video_paths"] = predicted_pos_video_paths
    log_copy["predicted_pos_video_gt_labels"] = predicted_pos_video_gt_labels
    log_copy["predicted_neg_video_paths"] = predicted_neg_video_paths
    log_copy["predicted_neg_video_gt_labels"] = predicted_neg_video_gt_labels
    return log_copy